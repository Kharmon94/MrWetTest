<% content_for :title, "Manage Tests - Sea Pass Pro" %>

<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-1 text-primary">
            <i class="fas fa-clipboard-list me-2"></i>
            Manage Tests
          </h1>
          <p class="text-muted mb-0">Create and manage assessments and certifications</p>
        </div>
        <%= link_to new_instructor_test_path, class: "btn btn-primary" do %>
          <i class="fas fa-plus me-1"></i> Create New Test
        <% end %>
      </div>
    </div>
  </div>

  <!-- Tests Table -->
  <% if @tests.any? %>
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">All Tests</h6>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered" width="100%" cellspacing="0">
            <thead>
              <tr>
                <th>Test Title</th>
                <th>Type</th>
                <th>Questions</th>
                <th>Price</th>
                <th>Completions</th>
                <th>Avg Score</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @tests.each do |test| %>
                <tr>
                  <td>
                    <div>
                      <div class="font-weight-bold text-dark"><%= test.title %></div>
                      <small class="text-muted"><%= truncate(test.description, length: 60) %></small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-<%= test.assessment_type == 'final' ? 'primary' : test.assessment_type == 'chapter' ? 'info' : 'secondary' %>">
                      <%= test.assessment_type.humanize %>
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">
                      <%= test.questions.count %> questions
                    </span>
                  </td>
                  <td>
                    <span class="<%= test.free? ? 'text-success' : 'text-primary' %>">
                      <%= test.formatted_price %>
                    </span>
                  </td>
                  <td>
                    <div class="text-center">
                      <div class="h6 mb-0"><%= test.completion_count %></div>
                      <small class="text-muted">completions</small>
                    </div>
                  </td>
                  <td>
                    <div class="text-center">
                      <div class="h6 mb-0"><%= test.average_score %>%</div>
                      <small class="text-muted">average</small>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex flex-column gap-1">
                      <% if test.honor_statement_required? %>
                        <span class="badge bg-info">
                          <i class="fas fa-shield-alt me-1"></i>
                          Honor Required
                        </span>
                      <% end %>
                      <% if test.time_limit.present? %>
                        <span class="badge bg-warning">
                          <i class="fas fa-clock me-1"></i>
                          <%= test.time_limit %>min
                        </span>
                      <% end %>
                      <% if test.max_attempts.present? %>
                        <span class="badge bg-secondary">
                          <i class="fas fa-repeat me-1"></i>
                          <%= test.max_attempts %> max
                        </span>
                      <% end %>
                    </div>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <%= link_to instructor_test_path(test), class: "btn btn-outline-primary" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      <%= link_to edit_instructor_test_path(test), class: "btn btn-outline-secondary" do %>
                        <i class="fas fa-edit"></i>
                      <% end %>
                      <%= link_to instructor_test_path(test), 
                                  method: :delete, 
                                  class: "btn btn-outline-danger",
                                  data: { 
                                    confirm: "Are you sure you want to delete this test?",
                                    turbo_method: :delete 
                                  } do %>
                        <i class="fas fa-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="fas fa-clipboard-list fa-5x text-muted"></i>
      </div>
      <h3 class="text-muted mb-3">No tests yet</h3>
      <p class="text-muted mb-4">
        Create your first assessment or certification test to evaluate student knowledge.
      </p>
      <%= link_to new_instructor_test_path, class: "btn btn-primary btn-lg" do %>
        <i class="fas fa-plus me-2"></i> Create Your First Test
      <% end %>
    </div>
  <% end %>
</div>

<style>
.shadow {
  box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
}

.font-weight-bold {
  font-weight: 700 !important;
}

.table th {
  background-color: #f8f9fc;
  border-color: #e3e6f0;
  color: #5a5c69;
  font-weight: 600;
}

.table td {
  border-color: #e3e6f0;
  vertical-align: middle;
}

.badge {
  font-size: 0.75rem;
}

.bg-light {
  background-color: #f8f9fc !important;
}
</style>
