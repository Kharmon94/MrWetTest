<% content_for :title, "Create New Question - Sea Pass Pro" %>

<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Header -->
      <div class="d-flex align-items-center mb-4">
        <%= link_to instructor_questions_path, class: "btn btn-outline-secondary me-3" do %>
          <i class="fas fa-arrow-left"></i>
        <% end %>
        <div>
          <h1 class="h3 mb-1 text-primary">
            <i class="fas fa-plus me-2"></i>
            Create New Question
          </h1>
          <p class="text-muted mb-0">Add a new question to your question bank</p>
        </div>
      </div>

      <!-- Question Form -->
      <div class="card shadow">
        <div class="card-body">
          <%= form_with model: @question, url: instructor_questions_path, local: true, class: "needs-validation", novalidate: true do |form| %>
            <% if @question.errors.any? %>
              <div class="alert alert-danger">
                <h6>Please fix the following errors:</h6>
                <ul class="mb-0">
                  <% @question.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <!-- Test Selection -->
            <div class="row mb-4">
              <div class="col-12">
                <h5 class="text-primary mb-3">
                  <i class="fas fa-clipboard-list me-2"></i>
                  Test Assignment
                </h5>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-12">
                <%= form.label :test_id, "Assign to Test", class: "form-label" %>
                <%= form.select :test_id, 
                    options_from_collection_for_select(@tests, :id, :title, @question.test_id),
                    { prompt: "Select a test..." },
                    { class: "form-select #{'is-invalid' if @question.errors[:test_id].any?}", required: true } %>
                <div class="form-text">
                  Choose which test this question belongs to.
                </div>
              </div>
            </div>

            <!-- Question Content -->
            <hr class="my-4">
            <div class="row mb-4">
              <div class="col-12">
                <h5 class="text-primary mb-3">
                  <i class="fas fa-question-circle me-2"></i>
                  Question Content
                </h5>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <%= form.label :content, "Question Text", class: "form-label" %>
                <%= form.text_area :content, 
                    class: "form-control #{'is-invalid' if @question.errors[:content].any?}",
                    rows: 4,
                    placeholder: "Enter your question here. Be clear and specific to avoid ambiguity...",
                    required: true %>
                <div class="form-text">
                  Write a clear, unambiguous question that tests specific knowledge or skills.
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <%= form.label :correct_answer, "Correct Answer", class: "form-label" %>
                <%= form.text_area :correct_answer, 
                    class: "form-control #{'is-invalid' if @question.errors[:correct_answer].any?}",
                    rows: 3,
                    placeholder: "Enter the correct answer. For multiple choice, provide the exact option text...",
                    required: true %>
                <div class="form-text">
                  Provide the exact correct answer. This will be used for automatic grading.
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <hr class="my-4">
            <div class="d-flex justify-content-between">
              <%= link_to instructor_questions_path, class: "btn btn-outline-secondary" do %>
                <i class="fas fa-times me-1"></i> Cancel
              <% end %>
              <%= form.submit "Create Question", class: "btn btn-primary" do %>
                <i class="fas fa-save me-1"></i> Create Question
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Help Section -->
      <div class="card shadow mt-4">
        <div class="card-header bg-light">
          <h6 class="mb-0 text-primary">
            <i class="fas fa-lightbulb me-2"></i>
            Question Writing Guidelines
          </h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6>Best Practices</h6>
              <ul class="list-unstyled">
                <li><i class="fas fa-check text-success me-2"></i> Use clear, concise language</li>
                <li><i class="fas fa-check text-success me-2"></i> Avoid ambiguous wording</li>
                <li><i class="fas fa-check text-success me-2"></i> Test specific knowledge</li>
                <li><i class="fas fa-check text-success me-2"></i> Ensure answer accuracy</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6>Question Types</h6>
              <ul class="list-unstyled">
                <li><strong>Multiple Choice:</strong> "What is the primary purpose of SOLAS?"</li>
                <li><strong>True/False:</strong> "STCW requires continuous watchkeeping."</li>
                <li><strong>Fill-in:</strong> "The minimum age for seafarers is ___ years."</li>
                <li><strong>Short Answer:</strong> "Explain the purpose of EPIRB devices."</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Bulk Import Section -->
      <div class="card shadow mt-4">
        <div class="card-header bg-info text-white">
          <h6 class="mb-0">
            <i class="fas fa-upload me-2"></i>
            Bulk Import Questions
          </h6>
        </div>
        <div class="card-body">
          <p class="mb-3">
            Need to add many questions at once? Use our bulk import feature to upload questions from a CSV file.
          </p>
          <div class="d-grid gap-2 d-md-flex">
            <button class="btn btn-info" disabled>
              <i class="fas fa-file-csv me-1"></i> Import CSV (Coming Soon)
            </button>
            <button class="btn btn-outline-info" disabled>
              <i class="fas fa-download me-1"></i> Download Template
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.shadow {
  box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
}

.form-control:focus, .form-select:focus {
  border-color: #4e73df;
  box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
}

.btn-primary {
  background-color: #4e73df;
  border-color: #4e73df;
}

.btn-primary:hover {
  background-color: #2e59d9;
  border-color: #2e59d9;
}

.bg-light {
  background-color: #f8f9fc !important;
}
</style>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();
</script>
