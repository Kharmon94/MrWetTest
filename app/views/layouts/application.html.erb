<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <title><%= content_for(:title) || "Sea Pass Pro" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      /* Production-Ready Design System - Inspired by Awwwards Winners */
      
      /* CSS Custom Properties for Theme System */
      :root {
        /* Light Theme Colors */
        --primary-50: #f8fafc;
        --primary-100: #f1f5f9;
        --primary-200: #e2e8f0;
        --primary-300: #cbd5e1;
        --primary-400: #94a3b8;
        --primary-500: #64748b;
        --primary-600: #475569;
        --primary-700: #334155;
        --primary-800: #1e293b;
        --primary-900: #0f172a;
        
        /* Accent Colors */
        --accent-500: #3b82f6;
        --accent-600: #2563eb;
        --accent-700: #1d4ed8;
        
        /* Success/Error Colors */
        --success-500: #10b981;
        --error-500: #ef4444;
        --warning-500: #f59e0b;
        
        /* Typography */
        --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --font-family-mono: 'JetBrains Mono', 'Fira Code', monospace;
        
        /* Spacing Scale */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --space-2xl: 3rem;
        --space-3xl: 4rem;
        
        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-2xl: 1.5rem;
        
        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        
        /* Transitions */
        --transition-fast: 150ms ease-in-out;
        --transition-normal: 250ms ease-in-out;
        --transition-slow: 350ms ease-in-out;
      }
      
      /* Dark Theme Variables */
      [data-theme="dark"] {
        --bg-primary: var(--primary-900);
        --bg-secondary: var(--primary-800);
        --bg-tertiary: var(--primary-700);
        --bg-overlay: rgba(15, 23, 42, 0.8);
        --text-primary: var(--primary-50);
        --text-secondary: var(--primary-300);
        --text-muted: var(--primary-400);
        --border-primary: var(--primary-700);
        --border-secondary: var(--primary-600);
        --glass-bg: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
      }
      
      /* Light Theme Variables */
      [data-theme="light"] {
        --bg-primary: var(--primary-50);
        --bg-secondary: #ffffff;
        --bg-tertiary: var(--primary-100);
        --bg-overlay: rgba(255, 255, 255, 0.8);
        --text-primary: var(--primary-900);
        --text-secondary: var(--primary-600);
        --text-muted: var(--primary-500);
        --border-primary: var(--primary-200);
        --border-secondary: var(--primary-300);
        --glass-bg: rgba(255, 255, 255, 0.8);
        --glass-border: rgba(0, 0, 0, 0.1);
      }
      
      /* Base Styles */
      * {
        box-sizing: border-box;
      }
      
      html {
        scroll-behavior: smooth;
      }
      
      body {
        font-family: var(--font-family-primary);
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        transition: background-color var(--transition-normal), color var(--transition-normal);
        min-height: 100vh;
        margin: 0;
        padding: 0;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Typography Scale */
      h1, h2, h3, h4, h5, h6 {
        font-weight: 600;
        line-height: 1.2;
        color: var(--text-primary);
        margin-bottom: var(--space-md);
      }
      
      h1 { font-size: 2.5rem; }
      h2 { font-size: 2rem; }
      h3 { font-size: 1.5rem; }
      h4 { font-size: 1.25rem; }
      h5 { font-size: 1.125rem; }
      h6 { font-size: 1rem; }
      
      p {
        color: var(--text-secondary);
        margin-bottom: var(--space-md);
      }
      
      /* Navigation Styles */
      .navbar {
        background: var(--glass-bg) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-primary);
        transition: all var(--transition-normal);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: var(--space-md) 0;
      }
      
      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--text-primary) !important;
        text-decoration: none;
        transition: color var(--transition-fast);
      }
      
      .navbar-brand:hover {
        color: var(--accent-500) !important;
      }
      
      .nav-link {
        color: var(--text-secondary) !important;
        font-weight: 500;
        padding: var(--space-sm) var(--space-md) !important;
        border-radius: var(--radius-md);
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
      }
      
      .nav-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--accent-500);
        opacity: 0;
        transform: scale(0.8);
        transition: all var(--transition-fast);
        border-radius: var(--radius-md);
      }
      
      .nav-link:hover::before {
        opacity: 0.1;
        transform: scale(1);
      }
      
      .nav-link:hover {
        color: var(--text-primary) !important;
        transform: translateY(-1px);
      }
      
      /* Card Components */
      .card {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-xl);
        transition: all var(--transition-normal);
        overflow: hidden;
        position: relative;
      }
      
      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--accent-500), transparent);
        opacity: 0;
        transition: opacity var(--transition-normal);
      }
      
      .card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
        border-color: var(--accent-500);
      }
      
      .card:hover::before {
        opacity: 1;
      }
      
      /* Button Styles */
      .btn {
        font-weight: 600;
        border-radius: var(--radius-lg);
        padding: var(--space-sm) var(--space-lg);
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
      }
      
      .btn-primary {
        background: linear-gradient(135deg, var(--accent-500), var(--accent-600));
        color: white;
        box-shadow: var(--shadow-md);
      }
      
      .btn-primary:hover {
        background: linear-gradient(135deg, var(--accent-600), var(--accent-700));
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        color: white;
      }
      
      .btn-outline-primary {
        background: transparent;
        border: 2px solid var(--accent-500);
        color: var(--accent-500);
      }
      
      .btn-outline-primary:hover {
        background: var(--accent-500);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }
      
      .btn-ghost {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-primary);
      }
      
      .btn-ghost:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border-color: var(--border-secondary);
      }
      
      /* Form Elements */
      .form-control, .form-select {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        color: var(--text-primary);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        transition: all var(--transition-fast);
        font-family: var(--font-family-primary);
      }
      
      .form-control:focus, .form-select:focus {
        background: var(--bg-secondary);
        border-color: var(--accent-500);
        color: var(--text-primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
      }
      
      .form-control::placeholder {
        color: var(--text-muted);
      }
      
      /* Alert Components */
      .alert {
        border-radius: var(--radius-lg);
        border: none;
        padding: var(--space-lg);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-left: 4px solid;
      }
      
      .alert-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-500);
        border-left-color: var(--success-500);
      }
      
      .alert-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error-500);
        border-left-color: var(--error-500);
      }
      
      .alert-info {
        background: rgba(59, 130, 246, 0.1);
        color: var(--accent-500);
        border-left-color: var(--accent-500);
      }
      
      .alert-warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-500);
        border-left-color: var(--warning-500);
      }
      
      /* Hero Section */
      .hero-section {
        background: linear-gradient(135deg, var(--glass-bg) 0%, rgba(59, 130, 246, 0.05) 100%);
        border-radius: var(--radius-2xl);
        padding: var(--space-3xl);
        margin: var(--space-xl) 0;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        position: relative;
        overflow: hidden;
      }
      
      .hero-section::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
        animation: float 6s ease-in-out infinite;
      }
      
      @keyframes float {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        50% { transform: translate(-20px, -20px) rotate(180deg); }
      }
      
      /* Text Gradient */
      .text-gradient {
        background: linear-gradient(135deg, var(--accent-500), var(--accent-700));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      /* Theme Toggle */
      .theme-toggle {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-xl);
        padding: var(--space-sm);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        transition: all var(--transition-fast);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      
      .theme-toggle:hover {
        border-color: var(--accent-500);
        transform: translateY(-1px);
      }
      
      .theme-toggle-icon {
        width: 20px;
        height: 20px;
        transition: all var(--transition-fast);
      }
      
      /* Table Styles */
      .table {
        color: var(--text-primary);
        background: transparent;
      }
      
      .table-striped > tbody > tr:nth-of-type(odd) > td {
        background-color: var(--bg-tertiary);
      }
      
      .table-hover tbody tr:hover {
        background-color: var(--bg-tertiary);
      }
      
      /* Loading States */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }
      
      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border-primary);
        border-top: 2px solid var(--accent-500);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        .hero-section {
          padding: var(--space-xl);
          margin: var(--space-md) 0;
        }
        
        h1 { font-size: 2rem; }
        h2 { font-size: 1.75rem; }
        h3 { font-size: 1.25rem; }
      }
      
      /* Accessibility */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
      
      /* Focus Styles */
      .btn:focus-visible,
      .form-control:focus-visible,
      .nav-link:focus-visible {
        outline: 2px solid var(--accent-500);
        outline-offset: 2px;
      }

      /* Enhanced Dropdown Styling */
      .dropdown-menu {
        border: 1px solid var(--border-primary);
        box-shadow: var(--shadow-lg);
        backdrop-filter: blur(10px);
        animation: dropdownFadeIn 0.2s ease-out;
      }

      .dropdown-menu-dark {
        background: var(--bg-secondary);
        border-color: var(--border-primary);
      }

      .dropdown-item {
        transition: all 0.2s ease;
        color: var(--text-primary);
        padding: 0.75rem 1rem;
      }

      .dropdown-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        transform: translateX(4px);
      }

      .dropdown-item i {
        width: 16px;
        text-align: center;
      }

      .dropdown-header {
        color: var(--text-secondary);
        font-size: 0.875rem;
        padding: 0.75rem 1rem 0.5rem;
      }

      .dropdown-divider {
        border-color: var(--border-primary);
        margin: 0.5rem 0;
      }

      .dropdown-toggle::after {
        transition: transform 0.2s ease;
      }

      .dropdown-toggle[aria-expanded="true"]::after {
        transform: rotate(180deg);
      }

      /* User Avatar Styling */
      .user-avatar img {
        border: 2px solid var(--border-primary);
        transition: border-color 0.2s ease;
      }

      .dropdown:hover .user-avatar img {
        border-color: var(--accent-500);
      }

      /* Admin Dropdown Special Styling */
      .nav-link.text-warning {
        color: #fbbf24 !important;
      }

      .nav-link.text-warning:hover {
        color: #f59e0b !important;
      }

      /* Dropdown Animation */
      @keyframes dropdownFadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Mobile Dropdown Improvements */
      @media (max-width: 991.98px) {
        .dropdown-menu {
          border: none;
          box-shadow: none;
          background: var(--bg-tertiary);
        }
        
        .dropdown-item {
          padding: 1rem;
          border-bottom: 1px solid var(--border-primary);
        }
        
        .dropdown-item:last-child {
          border-bottom: none;
        }
      }

      /* Mobile Responsiveness Improvements */
      @media (max-width: 767.98px) {
        /* Prevent horizontal scroll */
        body {
          overflow-x: hidden;
        }
        
        /* Container adjustments */
        .container-fluid {
          padding-left: 15px;
          padding-right: 15px;
        }
        
        /* Navigation improvements */
        .navbar-brand {
          font-size: 1.1rem;
        }
        
        .theme-toggle {
          padding: 0.25rem 0.5rem;
        }
        
        /* Button adjustments */
        .btn-lg {
          padding: 0.75rem 1.5rem;
          font-size: 1rem;
        }
        
        /* Card adjustments */
        .card {
          margin-bottom: 1rem;
        }
        
        .card-body {
          padding: 1rem;
        }
        
        /* Form adjustments */
        .form-control {
          font-size: 16px; /* Prevents zoom on iOS */
        }
        
        /* Text adjustments */
        .display-4 {
          font-size: 2rem;
        }
        
        .lead {
          font-size: 1.1rem;
        }
        
        /* Table responsiveness */
        .table-responsive {
          border: none;
        }
        
        /* Spacing adjustments */
        .py-5 {
          padding-top: 2rem !important;
          padding-bottom: 2rem !important;
        }
        
        .mb-5 {
          margin-bottom: 2rem !important;
        }
        
        /* Flex adjustments */
        .d-flex.gap-3 {
          gap: 0.75rem !important;
        }
        
        .d-flex.gap-2 {
          gap: 0.5rem !important;
        }
        
        /* Hero section adjustments */
        .hero-section {
          padding: 2rem 0;
        }
        
        /* Grid adjustments */
        .row.g-4 {
          --bs-gutter-x: 1rem;
        }
        
        .row.g-3 {
          --bs-gutter-x: 0.75rem;
        }
      }

      @media (max-width: 575.98px) {
        /* Extra small devices */
        .container-fluid {
          padding-left: 10px;
          padding-right: 10px;
        }
        
        .btn {
          padding: 0.5rem 1rem;
          font-size: 0.9rem;
        }
        
        .card-body {
          padding: 0.75rem;
        }
        
        .display-4 {
          font-size: 1.75rem;
        }
        
        .h1, .h2, .h3 {
          font-size: 1.5rem;
        }
        
        .lead {
          font-size: 1rem;
        }
        
        /* Stack buttons vertically on very small screens */
        .d-flex.gap-3.flex-wrap {
          flex-direction: column;
          align-items: center;
        }
        
        .d-flex.gap-3.flex-wrap .btn {
          width: 100%;
          max-width: 300px;
        }
      }
    </style>
  </head>

  <body>
    <!-- Modern Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a class="navbar-brand" href="<%= root_path %>">
          <span class="text-gradient">Sea Pass Pro</span>
        </a>
        
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <svg class="theme-toggle-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
          </svg>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <%= link_to "Home", root_path, class: "nav-link" %>
            </li>
            
            <!-- Learning Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-graduation-cap me-1"></i>Learning
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li>
                  <%= link_to courses_path, class: "dropdown-item" do %>
                    <i class="fas fa-book me-2"></i>All Courses
                  <% end %>
                </li>
                <% if user_signed_in? && !current_user.has_role?(:admin) %>
                  <li>
                    <%= link_to browse_courses_path, class: "dropdown-item" do %>
                      <i class="fas fa-search me-2"></i>Browse Courses
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to courses_path, class: "dropdown-item" do %>
                      <i class="fas fa-user-graduate me-2"></i>My Enrolled Courses
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </li>
            
            <!-- Testing Dropdown -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-flask me-1"></i>Testing
              </a>
              <ul class="dropdown-menu dropdown-menu-dark">
                <li>
                  <%= link_to tests_path, class: "dropdown-item" do %>
                    <i class="fas fa-list me-2"></i>Available Tests
                  <% end %>
                </li>
                <% if user_signed_in? %>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to tests_test_attempts_path, class: "dropdown-item" do %>
                      <i class="fas fa-history me-2"></i>My Test History
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </li>
            
            <% if user_signed_in? %>
              <!-- Account Dropdown -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-user-circle me-1"></i>Account
                </a>
                <ul class="dropdown-menu dropdown-menu-dark">
                  <li>
                    <%= link_to payments_path, class: "dropdown-item" do %>
                      <i class="fas fa-credit-card me-2"></i>Payment History
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to settings_root_path, class: "dropdown-item" do %>
                      <i class="fas fa-cog me-2"></i>Settings & Preferences
                    <% end %>
                  </li>
                  <li>
                    <%= link_to settings_profile_path, class: "dropdown-item" do %>
                      <i class="fas fa-user me-2"></i>Profile
                    <% end %>
                  </li>
                  <li>
                    <%= link_to settings_security_path, class: "dropdown-item" do %>
                      <i class="fas fa-shield-alt me-2"></i>Security
                    <% end %>
                  </li>
                </ul>
              </li>
              
              <% if current_user.has_role?(:admin) %>
                <!-- Admin Dropdown -->
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle text-warning" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-crown me-1"></i>Admin
                  </a>
                  <ul class="dropdown-menu dropdown-menu-dark">
                    <li>
                      <%= link_to admin_root_path, class: "dropdown-item" do %>
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                      <% end %>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <%= link_to admin_users_path, class: "dropdown-item" do %>
                        <i class="fas fa-users me-2"></i>Manage Users
                      <% end %>
                    </li>
                    <li>
                      <%= link_to admin_courses_path, class: "dropdown-item" do %>
                        <i class="fas fa-book me-2"></i>Manage Courses
                      <% end %>
                    </li>
                    <li>
                      <%= link_to admin_tests_path, class: "dropdown-item" do %>
                        <i class="fas fa-flask me-2"></i>Manage Tests
                      <% end %>
                    </li>
                    <li>
                      <%= link_to admin_questions_path, class: "dropdown-item" do %>
                        <i class="fas fa-question-circle me-2"></i>Manage Questions
                      <% end %>
                    </li>
                  </ul>
                </li>
              <% end %>
            <% end %>
          </ul>
          
          <ul class="navbar-nav align-items-center">
            <!-- Theme Toggle -->
            <li class="nav-item me-3">
              <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <svg class="theme-toggle-icon" id="themeIcon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                </svg>
              </button>
            </li>
            
      <% if user_signed_in? %>
              <!-- User Menu Dropdown -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <div class="user-avatar me-2">
                    <% if current_user.avatar.attached? %>
                      <%= image_tag current_user.avatar.variant(resize_to_limit: [32, 32]), 
                          class: "rounded-circle", 
                          style: "width: 32px; height: 32px; object-fit: cover;" %>
                    <% else %>
                      <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                        <i class="fas fa-user text-primary"></i>
                      </div>
                    <% end %>
                  </div>
                  <span class="d-none d-lg-inline"><%= current_user.email.split('@').first %></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                  <li class="dropdown-header">
                    <div class="fw-semibold"><%= current_user.email %></div>
                    <small class="text-muted">
                      <% if current_user.has_role?(:admin) %>
                        Administrator
      <% else %>
                        Student
                      <% end %>
                    </small>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to settings_root_path, class: "dropdown-item" do %>
                      <i class="fas fa-cog me-2"></i>Settings
                    <% end %>
                  </li>
                  <li>
                    <%= link_to settings_profile_path, class: "dropdown-item" do %>
                      <i class="fas fa-user me-2"></i>Profile
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to destroy_user_session_path, 
                        method: :delete, 
                        data: { turbo_method: :delete },
                        class: "dropdown-item text-danger" do %>
                      <i class="fas fa-sign-out-alt me-2"></i>Sign Out
      <% end %>
                  </li>
                </ul>
              </li>
            <% else %>
              <li class="nav-item me-2">
                <%= link_to "Sign In", new_user_session_path, class: "btn btn-ghost btn-sm" %>
              </li>
              <li class="nav-item">
                <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary btn-sm" %>
              </li>
      <% end %>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main style="margin-top: 80px;">
      <div class="container-fluid px-3 px-md-4 py-4">
        <!-- Flash Messages -->
      <% if notice.present? %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= notice %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
      <% end %>
      <% if alert.present? %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= alert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
      <% end %>
        
      <%= yield %>
    </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Stripe JS -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Enhanced JavaScript -->
    <script>
      // Stripe Configuration
      <% if Rails.application.config.stripe_publishable_key.present? %>
        const stripe = Stripe('<%= Rails.application.config.stripe_publishable_key %>');
      <% else %>
        const stripe = null;
        console.warn('Stripe publishable key not configured');
      <% end %>

      // Theme Management System
      class ThemeManager {
        constructor() {
          this.theme = localStorage.getItem('theme') || 'dark'
          this.themeIcon = document.getElementById('themeIcon')
          this.themeToggle = document.getElementById('themeToggle')
          this.init()
        }

        init() {
          this.setTheme(this.theme)
          this.bindEvents()
        }

        setTheme(theme) {
          this.theme = theme
          document.documentElement.setAttribute('data-theme', theme)
          localStorage.setItem('theme', theme)
          this.updateIcon()
        }

        updateIcon() {
          const sunIcon = `<path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>`
          
          const moonIcon = `<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>`

          if (this.themeIcon) {
            this.themeIcon.innerHTML = this.theme === 'dark' ? sunIcon : moonIcon
          }
        }

        bindEvents() {
          if (this.themeToggle) {
            this.themeToggle.addEventListener('click', () => {
              const newTheme = this.theme === 'dark' ? 'light' : 'dark'
              this.setTheme(newTheme)
            })
          }
        }
      }

      // Enhanced UI Interactions
      class UIManager {
        constructor() {
          this.init()
        }

        init() {
          this.initializeBootstrapComponents()
          this.setupSmoothScrolling()
          this.setupFormLoadingStates()
          this.setupCardAnimations()
          this.setupNavbarScroll()
        }

        initializeBootstrapComponents() {
          // Initialize tooltips
          const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
          tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
          })

          // Initialize popovers
          const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
          popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
          })
        }

        setupSmoothScrolling() {
          document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
              e.preventDefault()
              const target = document.querySelector(this.getAttribute('href'))
              if (target) {
                target.scrollIntoView({
                  behavior: 'smooth',
                  block: 'start'
                })
              }
            })
          })
        }

        setupFormLoadingStates() {
          document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function() {
              const submitBtn = this.querySelector('input[type="submit"], button[type="submit"]')
              if (submitBtn && !submitBtn.disabled) {
                const originalText = submitBtn.innerHTML
                submitBtn.disabled = true
                submitBtn.innerHTML = '<span class="spinner me-2"></span>Loading...'
                
                // Re-enable after 10 seconds as fallback
                setTimeout(() => {
                  if (submitBtn.disabled) {
                    submitBtn.disabled = false
                    submitBtn.innerHTML = originalText
                  }
                }, 10000)
              }
            })
          })
        }

        setupCardAnimations() {
          // Intersection Observer for card animations
          const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
          }

          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.style.opacity = '1'
                entry.target.style.transform = 'translateY(0)'
              }
            })
          }, observerOptions)

          document.querySelectorAll('.card').forEach(card => {
            card.style.opacity = '0'
            card.style.transform = 'translateY(20px)'
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease'
            observer.observe(card)
          })
        }

        setupNavbarScroll() {
          let lastScrollTop = 0
          const navbar = document.querySelector('.navbar')
          
          window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
              // Scrolling down
              navbar.style.transform = 'translateY(-100%)'
            } else {
              // Scrolling up
              navbar.style.transform = 'translateY(0)'
            }
            
            lastScrollTop = scrollTop
          })
        }
      }

      // Initialize everything when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        new ThemeManager()
        new UIManager()
      })

      // Performance optimization: Lazy load images
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target
              img.src = img.dataset.src
              img.classList.remove('lazy')
              imageObserver.unobserve(img)
            }
          })
        })

        document.querySelectorAll('img[data-src]').forEach(img => {
          imageObserver.observe(img)
        })
      }
    </script>
  </body>
</html>
