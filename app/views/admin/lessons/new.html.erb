<% content_for :title, "Admin - New Lesson" %>

<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
              <li class="breadcrumb-item">
                <%= link_to "Admin", admin_root_path, class: "text-decoration-none" %>
              </li>
              <li class="breadcrumb-item">
                <%= link_to "Lessons", admin_lessons_path, class: "text-decoration-none" %>
              </li>
              <li class="breadcrumb-item active" aria-current="page">New Lesson</li>
            </ol>
          </nav>
          <h1 class="h2 mb-0">Create New Lesson</h1>
          <p class="text-muted mb-0">Add a new lesson to a course</p>
        </div>
        
        <div class="d-flex gap-2">
          <%= link_to admin_lessons_path, class: "btn btn-outline-secondary" do %>
            <i class="fas fa-arrow-left me-2"></i>Back to Lessons
          <% end %>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-plus me-2"></i>Lesson Information
              </h5>
            </div>
            <div class="card-body">
              <%= form_with model: [:admin, @lesson], local: true, class: "needs-validation", novalidate: true do |form| %>
                <% if @lesson.errors.any? %>
                  <div class="alert alert-danger">
                    <h6>Please fix the following errors:</h6>
                    <ul class="mb-0">
                      <% @lesson.errors.full_messages.each do |message| %>
                        <li><%= message %></li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>

                <div class="row">
                  <div class="col-md-8 mb-3">
                    <%= form.label :title, class: "form-label" do %>
                      Lesson Title <span class="text-danger">*</span>
                    <% end %>
                    <%= form.text_field :title, class: "form-control", required: true, 
                        placeholder: "Enter lesson title" %>
                    <div class="invalid-feedback">
                      Please provide a lesson title.
                    </div>
                  </div>
                  
                  <div class="col-md-4 mb-3">
                    <%= form.label :position, class: "form-label" do %>
                      Position
                    <% end %>
                    <%= form.number_field :position, class: "form-control", 
                        placeholder: "Lesson order" %>
                    <div class="form-text">
                      Order of this lesson in the course
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <%= form.label :course_id, class: "form-label" do %>
                    Course <span class="text-danger">*</span>
                  <% end %>
                  <%= form.select :course_id, 
                      options_from_collection_for_select(@courses, :id, :title, @lesson.course_id),
                      { prompt: "Select a course" }, 
                      { class: "form-select", required: true } %>
                  <div class="invalid-feedback">
                    Please select a course.
                  </div>
                </div>

                <div class="mb-3">
                  <%= form.label :content, class: "form-label" do %>
                    Lesson Content <span class="text-danger">*</span>
                  <% end %>
                  <%= form.text_area :content, class: "form-control", rows: 15, required: true,
                      placeholder: "Enter the lesson content here. You can use basic HTML formatting." %>
                  <div class="invalid-feedback">
                    Please provide lesson content.
                  </div>
                  <div class="form-text">
                    You can use basic HTML formatting like &lt;strong&gt;, &lt;em&gt;, &lt;ul&gt;, &lt;ol&gt;, etc.
                  </div>
                </div>

                <div class="d-flex justify-content-between">
                  <%= link_to admin_lessons_path, class: "btn btn-secondary" do %>
                    <i class="fas fa-times me-2"></i>Cancel
                  <% end %>
                  
                  <%= form.submit "Create Lesson", class: "btn btn-primary" do %>
                    <i class="fas fa-save me-2"></i>Create Lesson
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Help Card -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-lightbulb me-2"></i>Tips for Creating Lessons
              </h6>
            </div>
            <div class="card-body">
              <ul class="list-unstyled mb-0">
                <li class="mb-2">
                  <i class="fas fa-check text-success me-2"></i>
                  Use clear, descriptive titles
                </li>
                <li class="mb-2">
                  <i class="fas fa-check text-success me-2"></i>
                  Set positions to control lesson order
                </li>
                <li class="mb-2">
                  <i class="fas fa-check text-success me-2"></i>
                  Use HTML for rich text formatting
                </li>
                <li class="mb-2">
                  <i class="fas fa-check text-success me-2"></i>
                  Break content into digestible sections
                </li>
                <li class="mb-0">
                  <i class="fas fa-check text-success me-2"></i>
                  Consider adding tests for each lesson
                </li>
              </ul>
            </div>
          </div>

          <!-- HTML Formatting Help -->
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-code me-2"></i>HTML Formatting Help
              </h6>
            </div>
            <div class="card-body">
              <small>
                <strong>Basic formatting:</strong><br>
                <code>&lt;strong&gt;bold text&lt;/strong&gt;</code><br>
                <code>&lt;em&gt;italic text&lt;/em&gt;</code><br>
                <code>&lt;p&gt;paragraph&lt;/p&gt;</code><br>
                <code>&lt;br&gt;</code> (line break)<br>
                <br>
                <strong>Lists:</strong><br>
                <code>&lt;ul&gt;&lt;li&gt;item&lt;/li&gt;&lt;/ul&gt;</code><br>
                <code>&lt;ol&gt;&lt;li&gt;item&lt;/li&gt;&lt;/ol&gt;</code><br>
                <br>
                <strong>Headers:</strong><br>
                <code>&lt;h3&gt;Section Title&lt;/h3&gt;</code>
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();
</script>
