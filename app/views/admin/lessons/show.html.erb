<% content_for :title, "Admin - #{@lesson.title}" %>

<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
              <li class="breadcrumb-item">
                <%= link_to "Admin", admin_root_path, class: "text-decoration-none" %>
              </li>
              <li class="breadcrumb-item">
                <%= link_to "Lessons", admin_lessons_path, class: "text-decoration-none" %>
              </li>
              <li class="breadcrumb-item active" aria-current="page"><%= @lesson.title %></li>
            </ol>
          </nav>
          <h1 class="h2 mb-0"><%= @lesson.title %></h1>
          <p class="text-muted mb-0">
            Lesson in <%= link_to @lesson.course.title, admin_course_path(@lesson.course), 
                class: "text-decoration-none" %>
          </p>
        </div>
        
        <div class="d-flex gap-2">
          <%= link_to admin_lessons_path, class: "btn btn-outline-secondary" do %>
            <i class="fas fa-arrow-left me-2"></i>Back to Lessons
          <% end %>
          <%= link_to edit_admin_lesson_path(@lesson), class: "btn btn-primary" do %>
            <i class="fas fa-edit me-2"></i>Edit Lesson
          <% end %>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8">
          <!-- Lesson Content -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-book me-2"></i>Lesson Content
              </h5>
            </div>
            <div class="card-body">
              <div class="lesson-content">
                <%= simple_format(@lesson.content, {}, wrapper_tag: "div") %>
              </div>
            </div>
          </div>

          <!-- Lesson Tests -->
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="fas fa-clipboard-check me-2"></i>Associated Tests
                </h5>
                <%= link_to new_admin_test_path, class: "btn btn-primary btn-sm" do %>
                  <i class="fas fa-plus me-1"></i>Add Test
                <% end %>
              </div>
            </div>
            <div class="card-body">
              <% if @lesson.tests.any? %>
                <div class="table-responsive">
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Questions</th>
                        <th>Created</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @lesson.tests.each do |test| %>
                        <tr>
                          <td>
                            <strong><%= test.title %></strong>
                            <br>
                            <small class="text-muted"><%= truncate(test.description, length: 50) %></small>
                          </td>
                          <td>
                            <span class="badge bg-<%= test.assessment_type == 'final' ? 'danger' : 'warning' %>">
                              <%= test.assessment_type.titleize %>
                            </span>
                          </td>
                          <td>
                            <span class="badge bg-info"><%= test.questions.count %></span>
                          </td>
                          <td>
                            <small class="text-muted">
                              <%= test.created_at.strftime("%b %d, %Y") %>
                            </small>
                          </td>
                          <td>
                            <div class="btn-group btn-group-sm">
                              <%= link_to admin_test_path(test), 
                                  class: "btn btn-outline-primary", 
                                  title: "View Test" do %>
                                <i class="fas fa-eye"></i>
                              <% end %>
                              <%= link_to edit_admin_test_path(test), 
                                  class: "btn btn-outline-warning", 
                                  title: "Edit Test" do %>
                                <i class="fas fa-edit"></i>
                              <% end %>
                            </div>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <div class="text-center py-4">
                  <i class="fas fa-clipboard-check fa-3x text-muted mb-3"></i>
                  <h6 class="text-muted">No Tests Associated</h6>
                  <p class="text-muted mb-3">This lesson doesn't have any tests yet.</p>
                  <%= link_to new_admin_test_path, class: "btn btn-primary" do %>
                    <i class="fas fa-plus me-2"></i>Create Test for This Lesson
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Lesson Details -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>Lesson Details
              </h6>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <strong>Course:</strong><br>
                <%= link_to @lesson.course.title, admin_course_path(@lesson.course), 
                    class: "text-decoration-none" %>
              </div>
              
              <div class="mb-3">
                <strong>Position:</strong><br>
                <% if @lesson.position %>
                  <span class="badge bg-primary">Lesson <%= @lesson.position %></span>
                <% else %>
                  <span class="badge bg-warning">No Position Set</span>
                <% end %>
              </div>
              
              <div class="mb-3">
                <strong>Content Length:</strong><br>
                <span class="badge bg-info"><%= @lesson.content.length %> characters</span>
              </div>
              
              <div class="mb-3">
                <strong>Associated Tests:</strong><br>
                <span class="badge bg-success"><%= @lesson.tests.count %></span>
              </div>
              
              <div class="mb-0">
                <strong>Created:</strong><br>
                <small class="text-muted">
                  <%= @lesson.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                </small>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-bolt me-2"></i>Quick Actions
              </h6>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <%= link_to edit_admin_lesson_path(@lesson), class: "btn btn-warning" do %>
                  <i class="fas fa-edit me-2"></i>Edit Lesson
                <% end %>
                <%= link_to new_admin_test_path, class: "btn btn-primary" do %>
                  <i class="fas fa-plus me-2"></i>Add Test
                <% end %>
                <%= link_to course_lesson_path(@lesson.course, @lesson), 
                    class: "btn btn-info", target: "_blank" do %>
                  <i class="fas fa-external-link-alt me-2"></i>View as Student
                <% end %>
                <%= link_to admin_lesson_path(@lesson), 
                    method: :delete,
                    data: { 
                      confirm: "Are you sure you want to delete this lesson? This action cannot be undone.",
                      turbo_method: :delete
                    },
                    class: "btn btn-danger" do %>
                  <i class="fas fa-trash me-2"></i>Delete Lesson
                <% end %>
              </div>
            </div>
          </div>

          <!-- Course Information -->
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-graduation-cap me-2"></i>Course Information
              </h6>
            </div>
            <div class="card-body">
              <p class="card-text mb-2">
                <strong>Title:</strong><br>
                <%= @lesson.course.title %>
              </p>
              <p class="card-text mb-2">
                <strong>Total Lessons:</strong><br>
                <%= @lesson.course.lessons.count %>
              </p>
              <p class="card-text mb-0">
                <strong>Total Tests:</strong><br>
                <%= @lesson.course.tests.count %>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.lesson-content {
  line-height: 1.8;
  font-size: 1.1rem;
}

.lesson-content p {
  margin-bottom: 1.5rem;
}

.lesson-content h1, .lesson-content h2, .lesson-content h3 {
  margin-top: 2rem;
  margin-bottom: 1rem;
  color: #2c3e50;
}

.lesson-content ul, .lesson-content ol {
  margin-bottom: 1.5rem;
  padding-left: 2rem;
}

.lesson-content li {
  margin-bottom: 0.5rem;
}
</style>
