<% content_for :title, "Admin - Lessons" %>

<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
              <li class="breadcrumb-item">
                <%= link_to "Admin", admin_root_path, class: "text-decoration-none" %>
              </li>
              <li class="breadcrumb-item active" aria-current="page">Lessons</li>
            </ol>
          </nav>
          <h1 class="h2 mb-0">Manage Lessons</h1>
          <p class="text-muted mb-0">Create and manage course lessons</p>
        </div>
        
        <div class="d-flex gap-2">
          <%= link_to new_admin_lesson_path, class: "btn btn-primary" do %>
            <i class="fas fa-plus me-2"></i>New Lesson
          <% end %>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0"><%= @lessons.count %></h4>
                  <small>Total Lessons</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-book fa-2x opacity-75"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0"><%= @courses.count %></h4>
                  <small>Total Courses</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-graduation-cap fa-2x opacity-75"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0"><%= @lessons.joins(:tests).distinct.count %></h4>
                  <small>Lessons with Tests</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-clipboard-check fa-2x opacity-75"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0"><%= @lessons.where(position: nil).count %></h4>
                  <small>Unordered Lessons</small>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-sort fa-2x opacity-75"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Lessons Table -->
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">All Lessons</h5>
            <div class="d-flex gap-2">
              <%= link_to admin_courses_path, class: "btn btn-outline-primary btn-sm" do %>
                <i class="fas fa-graduation-cap me-1"></i>Manage Courses
              <% end %>
            </div>
          </div>
        </div>
        <div class="card-body">
          <% if @lessons.any? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Course</th>
                    <th>Position</th>
                    <th>Tests</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @lessons.each do |lesson| %>
                    <tr>
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="me-3">
                            <i class="fas fa-book text-primary"></i>
                          </div>
                          <div>
                            <strong><%= lesson.title %></strong>
                            <br>
                            <small class="text-muted">
                              <%= truncate(lesson.content, length: 60) %>
                            </small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <%= link_to lesson.course.title, admin_course_path(lesson.course), 
                            class: "text-decoration-none" %>
                      </td>
                      <td>
                        <% if lesson.position %>
                          <span class="badge bg-primary"><%= lesson.position %></span>
                        <% else %>
                          <span class="badge bg-warning">No Position</span>
                        <% end %>
                      </td>
                      <td>
                        <% if lesson.tests.any? %>
                          <span class="badge bg-success">
                            <i class="fas fa-clipboard-check me-1"></i>
                            <%= lesson.tests.count %>
                          </span>
                        <% else %>
                          <span class="badge bg-secondary">
                            <i class="fas fa-times me-1"></i>
                            No Tests
                          </span>
                        <% end %>
                      </td>
                      <td>
                        <small class="text-muted">
                          <%= lesson.created_at.strftime("%b %d, %Y") %>
                        </small>
                      </td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <%= link_to admin_lesson_path(lesson), 
                              class: "btn btn-outline-primary", 
                              title: "View Lesson" do %>
                            <i class="fas fa-eye"></i>
                          <% end %>
                          <%= link_to edit_admin_lesson_path(lesson), 
                              class: "btn btn-outline-warning", 
                              title: "Edit Lesson" do %>
                            <i class="fas fa-edit"></i>
                          <% end %>
                          <%= link_to admin_lesson_path(lesson), 
                              method: :delete,
                              data: { 
                                confirm: "Are you sure you want to delete this lesson? This action cannot be undone.",
                                turbo_method: :delete
                              },
                              class: "btn btn-outline-danger", 
                              title: "Delete Lesson" do %>
                            <i class="fas fa-trash"></i>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <!-- Empty State -->
            <div class="text-center py-5">
              <div class="mb-4">
                <i class="fas fa-book fa-4x text-muted"></i>
              </div>
              <h3 class="text-muted">No Lessons Found</h3>
              <p class="text-muted mb-4">Get started by creating your first lesson.</p>
              <%= link_to new_admin_lesson_path, class: "btn btn-primary" do %>
                <i class="fas fa-plus me-2"></i>Create First Lesson
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
