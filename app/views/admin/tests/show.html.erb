<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <!-- Page Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 mb-0"><%= @test.title %></h1>
          <p class="text-muted mb-0">Test Details and Statistics</p>
        </div>
        <div>
          <%= link_to edit_admin_test_path(@test), class: "btn btn-outline-primary me-2" do %>
            <i class="fas fa-edit me-2"></i>Edit Test
          <% end %>
          <%= link_to admin_tests_path, class: "btn btn-secondary" do %>
            <i class="fas fa-arrow-left me-2"></i>Back to Tests
          <% end %>
        </div>
      </div>

      <div class="row">
        <!-- Test Information -->
        <div class="col-lg-8 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Test Information</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Basic Details</h6>
                  <table class="table table-sm">
                    <tr>
                      <td><strong>Title:</strong></td>
                      <td><%= @test.title %></td>
                    </tr>
                    <tr>
                      <td><strong>Type:</strong></td>
                      <td>
                        <span class="badge bg-<%= case @test.assessment_type
                                                  when 'final' then 'primary'
                                                  when 'chapter' then 'info'
                                                  when 'practice' then 'success'
                                                  when 'certification' then 'warning'
                                                  else 'secondary'
                                                end %>">
                          <%= @test.assessment_type&.titleize || 'Standard' %>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Questions:</strong></td>
                      <td><%= @test.questions.count %></td>
                    </tr>
                    <tr>
                      <td><strong>Created:</strong></td>
                      <td><%= @test.created_at.strftime("%B %d, %Y at %I:%M %p") %></td>
                    </tr>
                  </table>
                </div>
                <div class="col-md-6">
                  <h6>Assessment Settings</h6>
                  <table class="table table-sm">
                    <tr>
                      <td><strong>Time Limit:</strong></td>
                      <td>
                        <% if @test.time_limit.present? %>
                          <%= @test.time_limit_display %>
                        <% else %>
                          <span class="text-muted">No limit</span>
                        <% end %>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Passing Score:</strong></td>
                      <td>
                        <% if @test.passing_score.present? %>
                          <%= @test.passing_score_display %>
                        <% else %>
                          <span class="text-muted">Not set</span>
                        <% end %>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Max Attempts:</strong></td>
                      <td>
                        <% if @test.max_attempts.present? %>
                          <%= @test.max_attempts %>
                        <% else %>
                          <span class="text-muted">Unlimited</span>
                        <% end %>
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Honor Statement:</strong></td>
                      <td>
                        <% if @test.honor_statement_required? %>
                          <span class="badge bg-success">Required</span>
                        <% else %>
                          <span class="badge bg-secondary">Not Required</span>
                        <% end %>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
              
              <% if @test.description.present? %>
                <div class="mt-3">
                  <h6>Description</h6>
                  <p class="text-muted"><%= @test.description %></p>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Test Attempts -->
          <div class="card mt-4">
            <div class="card-header">
              <h5 class="card-title mb-0">Recent Test Attempts</h5>
            </div>
            <div class="card-body">
              <% if @test.test_attempts.any? %>
                <div class="table-responsive">
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>Student</th>
                        <th>Score</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Duration</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @test.test_attempts.order(created_at: :desc).limit(10).each do |attempt| %>
                        <tr>
                          <td>
                            <% if attempt.user %>
                              <%= attempt.user.email %>
                            <% else %>
                              <span class="text-muted">Unknown User</span>
                            <% end %>
                          </td>
                          <td>
                            <span class="badge bg-<%= attempt.passed? ? 'success' : 'danger' %>">
                              <%= attempt.score %>%
                            </span>
                          </td>
                          <td>
                            <% if attempt.submitted_at %>
                              <span class="badge bg-success">Completed</span>
                            <% else %>
                              <span class="badge bg-warning">In Progress</span>
                            <% end %>
                          </td>
                          <td>
                            <small><%= attempt.created_at.strftime("%m/%d/%Y") %></small>
                          </td>
                          <td>
                            <% if attempt.submitted_at %>
                              <small><%= attempt.duration_in_minutes %> min</small>
                            <% else %>
                              <small class="text-muted">-</small>
                            <% end %>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <div class="text-center py-3">
                  <i class="fas fa-chart-line fa-2x text-muted mb-2"></i>
                  <p class="text-muted mb-0">No attempts yet</p>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Statistics Sidebar -->
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="card-title mb-0">Statistics</h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-6 mb-3">
                  <h4 class="text-primary"><%= @total_attempts %></h4>
                  <small class="text-muted">Total Attempts</small>
                </div>
                <div class="col-6 mb-3">
                  <h4 class="text-success"><%= @pass_rate %>%</h4>
                  <small class="text-muted">Pass Rate</small>
                </div>
                <div class="col-6">
                  <h4 class="text-info"><%= @average_score %>%</h4>
                  <small class="text-muted">Avg Score</small>
                </div>
                <div class="col-6">
                  <h4 class="text-warning">
                    <%= @test.course.title if @test.course %>
                  </h4>
                  <small class="text-muted">Course</small>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <%= link_to admin_test_path(@test), method: :delete,
                            class: "btn btn-outline-danger",
                            data: { confirm: "Are you sure you want to delete this test? This action cannot be undone." } do %>
                  <i class="fas fa-trash me-2"></i>Delete Test
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
