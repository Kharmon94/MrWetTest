<div class="container py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Test Attempts</h1>
        <%= link_to "← Back to Admin", admin_root_path, class: "btn btn-outline-secondary" %>
      </div>

      <% if @test_attempts.any? %>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>User</th>
                    <th>Test</th>
                    <th>Score</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @test_attempts.each do |attempt| %>
                    <tr>
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="me-3">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" 
                                 style="width: 32px; height: 32px;">
                              <i class="fas fa-user text-primary"></i>
                            </div>
                          </div>
                          <div>
                            <div class="fw-semibold"><%= attempt.user.email %></div>
                            <small class="text-muted">ID: <%= attempt.user.id %></small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="fw-semibold"><%= attempt.test.title %></div>
                        <small class="text-muted"><%= attempt.test.assessment_type.titleize %></small>
                      </td>
                      <td>
                        <% if attempt.score.present? %>
                          <span class="badge <%= attempt.score >= attempt.test.passing_score ? 'bg-success' : 'bg-danger' %>">
                            <%= number_with_precision(attempt.score, precision: 1) %>%
                          </span>
                        <% else %>
                          <span class="badge bg-secondary">Not graded</span>
                        <% end %>
                      </td>
                      <td>
                        <% if attempt.submitted? %>
                          <span class="badge bg-success">Completed</span>
                        <% elsif attempt.end_time.present? && !attempt.submitted? %>
                          <span class="badge bg-warning">Abandoned</span>
                        <% else %>
                          <span class="badge bg-info">In Progress</span>
                        <% end %>
                      </td>
                      <td>
                        <div><%= attempt.created_at.strftime("%m/%d/%Y") %></div>
                        <small class="text-muted"><%= attempt.created_at.strftime("%I:%M %p") %></small>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <%= link_to "View", admin_test_attempt_path(attempt), class: "btn btn-sm btn-outline-primary" %>
                          <%= link_to "Edit", edit_admin_test_attempt_path(attempt), class: "btn btn-sm btn-outline-secondary" %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <% if defined?(Kaminari) && @test_attempts.respond_to?(:current_page) %>
          <div class="d-flex justify-content-center mt-4">
            <%= paginate @test_attempts %>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-clipboard-list text-muted" style="font-size: 4rem;"></i>
          </div>
          <h4 class="text-muted">No Test Attempts</h4>
          <p class="text-muted">No test attempts have been made yet.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
